@using EPiServer
@using EPiServer.Shell.Navigation
@using EPiServer.Shell.UI.Web.Mvc.Html
@using EPiServer.Web
@using Reingold.Optimizely.Reports.ContentTypeUsage

@model ContentTypeUsageReportViewModel

@{
    Layout = "/CmsUIViews/Views/Shared/CommonLayout.cshtml";
}

@section title {
    <title>Content Type Usage</title>
}

@section mainContent {
    <div @Html.ApplyPlatformNavigation("body")>

    <div>
        <h1>
            Content type usage
        </h1>
        <p>
            This report displays content items that use a selected content type
        </p>
    </div>

    @using (Html.BeginForm("index", "contenttypeusagereport", FormMethod.Post))
        {
            <script src="/Util/javascript/episerverscriptmanager.js" type="text/javascript"></script>
            <script src="/EPiServer/CMS/javascript/system.js" type="text/javascript"></script>
            <script src="/EPiServer/CMS/javascript/dialog.js" type="text/javascript"></script>
            <script src="/EPiServer/CMS/javascript/system.aspx" type="text/javascript"></script>

            <div class="epi-formArea">
                <fieldset>
                    <legend>
                         Report Criteria
                    </legend>
                    <div class="epi-size10">
                        <div>
                            <label for="contenttypeid">Content Type</label>
                            <select name="contenttypeid" class="episize240">
	                            @foreach (var contentType in Model.ContentTypes)
                                {
                                    <option value="@contentType.ID" @(Model.SelectedId == contentType.ID ? "selected" : "" )>@(contentType.DisplayName ?? contentType.Name)</option>
                                }
                            </select>
                        </div>
                    </div>
                </fieldset>

                <div class="epi-formArea">
                    <div class="epitoolbuttonrow">
                        <span class="epi-cmsButton">
                          <input class="epi-cmsButton-text epi-cmsButton-tools epi-cmsButton-Report" 
                                 type="submit" 
                                 name="showReport" 
                                 id="showReport" 
                                 value="Show Report" 
                                 onmouseover="EPi.ToolButton.MouseDownHandler(this)" 
                                 onmouseout="EPi.ToolButton.ResetMouseDownHandler(this)" />
                        </span>
                    </div>
 
                </div>
            </div>
        }
 
        @if (Model.Submitted)
        {
            <div class="epi-floatLeft epi-marginVertical-small">Number of content items found: @Model.ContentTypeUsages.Count()</div>
            <div class="epi-contentArea epi-clear">
                <div>
                    <table class="epi-default epi-default-legacy" 
                           cellspacing="0" 
                           id="FullRegion_MainRegion_ReportView" 
                           style="border-style: None; width: 100%; border-collapse: collapse;">
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Language</th>
                            <th scope="col">Name</th>
                        </tr>
                        @foreach (var content in Model.ContentTypeUsages)
                        {
                            <tr>
                                <td style="width: 27%;">@content.ContentLink.ID</td>
                                <td>@content.LanguageBranch</td>
                                <td><a href="@(UIPathResolver.Instance.CombineWithUIAbsolute($"{content.ContentLink.ID}?language={content.LanguageBranch}#context=epi.cms.contentdata:///{content.ContentLink.ID}"))">
                                    @content.Name</a>
                                </td>
                            </tr>
                        }
                    </table>
                </div>
            </div>
 
        }
}